#!/bin/bash

set -e

echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å Node.js..."
if ! command -v node &> /dev/null
then
    echo "‚ùå Node.js –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –π–æ–≥–æ —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É."
    exit 1
fi

echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –±–µ–∫–µ–Ω–¥—É..."
cd backend
npm install

echo "üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥..."
npm start

cd ../frontend
echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É..."
npm install

echo "‚öôÔ∏è –ë—É–¥—É—î–º–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥..."
npm run build

echo "üåç –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥..."
npm run preview

# –û—á—ñ–∫—É—î–º–æ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥, —â–æ–± —Å–µ—Ä–≤–µ—Ä–∏ —Å—Ç–∞—Ä—Ç—É–≤–∞–ª–∏
sleep 3

# –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —É –±—Ä–∞—É–∑–µ—Ä—ñ
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    xdg-open http://localhost:4173
elif [[ "$OSTYPE" == "darwin"* ]]; then
    open http://localhost:4173
fi

echo "‚úÖ –ü—Ä–æ—î–∫—Ç –∑–∞–ø—É—â–µ–Ω–æ! –ë–µ–∫–µ–Ω–¥: http://localhost:5000, –§—Ä–æ–Ω—Ç–µ–Ω–¥: http://localhost:4173"

# –¢—Ä–∏–º–∞—î–º–æ —Å–∫—Ä–∏–ø—Ç –∞–∫—Ç–∏–≤–Ω–∏–º, –ø–æ–∫–∏ –ø—Ä–∞—Ü—é—é—Ç—å —Å–µ—Ä–≤–µ—Ä–∏
wait
